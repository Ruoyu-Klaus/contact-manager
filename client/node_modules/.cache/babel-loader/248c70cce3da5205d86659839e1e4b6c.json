{"ast":null,"code":"import _regeneratorRuntime from\"/Users/ruoyuwang/Documents/GitHub/contact-keeper/client/node_modules/@babel/runtime/regenerator\";import _asyncToGenerator from\"/Users/ruoyuwang/Documents/GitHub/contact-keeper/client/node_modules/@babel/runtime/helpers/esm/asyncToGenerator\";import _slicedToArray from\"/Users/ruoyuwang/Documents/GitHub/contact-keeper/client/node_modules/@babel/runtime/helpers/esm/slicedToArray\";import React,{useReducer}from'react';import axios from'axios';import authContext from'./authContext';import authReducer from'./authReducer';import{REGISTER_SUCCESS,REGISTER_FAIL,USER_LOADED,AUTH_ERROR,LOGIN_SUCCESS,LOGIN_FAIL,LOGINOUT,CLEAR_ERRORS}from'../types';import setAuthToken from'../../utils/setAuthToken';var AuthState=function AuthState(props){var initialState={token:localStorage.getItem('token'),isAuthenticated:null,user:null,loading:false,error:null};var _useReducer=useReducer(authReducer,initialState),_useReducer2=_slicedToArray(_useReducer,2),state=_useReducer2[0],dispatch=_useReducer2[1];// Load User\nvar loadUser=/*#__PURE__*/function(){var _ref=_asyncToGenerator(/*#__PURE__*/_regeneratorRuntime.mark(function _callee(){var res;return _regeneratorRuntime.wrap(function _callee$(_context){while(1){switch(_context.prev=_context.next){case 0:if(localStorage.token){setAuthToken(localStorage.getItem('token'));}_context.prev=1;_context.next=4;return axios.get('/api/auth');case 4:res=_context.sent;dispatch({type:USER_LOADED,payload:res.data});_context.next=11;break;case 8:_context.prev=8;_context.t0=_context[\"catch\"](1);dispatch({type:AUTH_ERROR});case 11:case\"end\":return _context.stop();}}},_callee,null,[[1,8]]);}));return function loadUser(){return _ref.apply(this,arguments);};}();// Register User\nvar register=/*#__PURE__*/function(){var _ref2=_asyncToGenerator(/*#__PURE__*/_regeneratorRuntime.mark(function _callee2(formData){var config,res;return _regeneratorRuntime.wrap(function _callee2$(_context2){while(1){switch(_context2.prev=_context2.next){case 0:config={header:{'content-type':'application/json'}};_context2.prev=1;_context2.next=4;return axios.post('/api/users',formData,config);case 4:res=_context2.sent;//PASS THE TOKEN ONCE SUCCESS\ndispatch({type:REGISTER_SUCCESS,payload:res.data});loadUser();_context2.next=13;break;case 9:_context2.prev=9;_context2.t0=_context2[\"catch\"](1);console.log(_context2.t0.response);dispatch({type:REGISTER_FAIL,payload:_context2.t0.response.data.msg});case 13:case\"end\":return _context2.stop();}}},_callee2,null,[[1,9]]);}));return function register(_x){return _ref2.apply(this,arguments);};}();// Login User\nvar loginUser=/*#__PURE__*/function(){var _ref3=_asyncToGenerator(/*#__PURE__*/_regeneratorRuntime.mark(function _callee3(formData){var config,res;return _regeneratorRuntime.wrap(function _callee3$(_context3){while(1){switch(_context3.prev=_context3.next){case 0:config={header:{'content-type':'application/json'}};_context3.prev=1;_context3.next=4;return axios.post('/api/auth',formData,config);case 4:res=_context3.sent;//PASS THE TOKEN ONCE SUCCESS\ndispatch({type:LOGIN_SUCCESS,payload:res.data});loadUser();_context3.next=12;break;case 9:_context3.prev=9;_context3.t0=_context3[\"catch\"](1);dispatch({type:LOGIN_FAIL,payload:_context3.t0.response.data.msg});case 12:case\"end\":return _context3.stop();}}},_callee3,null,[[1,9]]);}));return function loginUser(_x2){return _ref3.apply(this,arguments);};}();//Logout\nvar logoutUser=function logoutUser(){return dispatch({type:LOGINOUT});};//Clear Errors\nvar clearError=function clearError(){return dispatch({type:CLEAR_ERRORS});};return/*#__PURE__*/React.createElement(authContext.Provider,{value:{token:state.token,isAuthenticated:state.isAuthenticated,user:state.user,loading:state.loading,error:state.error,register:register,loadUser:loadUser,loginUser:loginUser,logoutUser:logoutUser,clearError:clearError}},props.children);};export default AuthState;","map":{"version":3,"sources":["/Users/ruoyuwang/Documents/GitHub/contact-keeper/client/src/Context/Auth/AuthState.js"],"names":["React","useReducer","axios","authContext","authReducer","REGISTER_SUCCESS","REGISTER_FAIL","USER_LOADED","AUTH_ERROR","LOGIN_SUCCESS","LOGIN_FAIL","LOGINOUT","CLEAR_ERRORS","setAuthToken","AuthState","props","initialState","token","localStorage","getItem","isAuthenticated","user","loading","error","state","dispatch","loadUser","get","res","type","payload","data","register","formData","config","header","post","console","log","response","msg","loginUser","logoutUser","clearError","children"],"mappings":"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","sourcesContent":["import React, { useReducer } from 'react';\nimport axios from 'axios';\nimport authContext from './authContext';\nimport authReducer from './authReducer';\n\nimport {\n  REGISTER_SUCCESS,\n  REGISTER_FAIL,\n  USER_LOADED,\n  AUTH_ERROR,\n  LOGIN_SUCCESS,\n  LOGIN_FAIL,\n  LOGINOUT,\n  CLEAR_ERRORS,\n} from '../types';\n\nimport setAuthToken from '../../utils/setAuthToken';\n\nconst AuthState = props => {\n  const initialState = {\n    token: localStorage.getItem('token'),\n    isAuthenticated: null,\n    user: null,\n    loading: false,\n    error: null,\n  };\n\n  const [state, dispatch] = useReducer(authReducer, initialState);\n\n  // Load User\n  const loadUser = async () => {\n    if (localStorage.token) {\n      setAuthToken(localStorage.getItem('token'));\n    }\n    try {\n      const res = await axios.get('/api/auth');\n      dispatch({ type: USER_LOADED, payload: res.data });\n    } catch (error) {\n      dispatch({ type: AUTH_ERROR });\n    }\n  };\n  // Register User\n  const register = async formData => {\n    const config = { header: { 'content-type': 'application/json' } };\n    try {\n      const res = await axios.post('/api/users', formData, config);\n      //PASS THE TOKEN ONCE SUCCESS\n      dispatch({ type: REGISTER_SUCCESS, payload: res.data });\n      loadUser();\n    } catch (error) {\n      console.log(error.response);\n      dispatch({ type: REGISTER_FAIL, payload: error.response.data.msg });\n    }\n  };\n\n  // Login User\n  const loginUser = async formData => {\n    const config = { header: { 'content-type': 'application/json' } };\n    try {\n      const res = await axios.post('/api/auth', formData, config);\n      //PASS THE TOKEN ONCE SUCCESS\n      dispatch({ type: LOGIN_SUCCESS, payload: res.data });\n      loadUser();\n    } catch (error) {\n      dispatch({ type: LOGIN_FAIL, payload: error.response.data.msg });\n    }\n  };\n\n  //Logout\n  const logoutUser = () => dispatch({ type: LOGINOUT });\n  //Clear Errors\n  const clearError = () => dispatch({ type: CLEAR_ERRORS });\n  return (\n    <authContext.Provider\n      value={{\n        token: state.token,\n        isAuthenticated: state.isAuthenticated,\n        user: state.user,\n        loading: state.loading,\n        error: state.error,\n        register,\n        loadUser,\n        loginUser,\n        logoutUser,\n        clearError,\n      }}\n    >\n      {props.children}\n    </authContext.Provider>\n  );\n};\n\nexport default AuthState;\n"]},"metadata":{},"sourceType":"module"}